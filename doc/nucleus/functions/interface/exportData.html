<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of exportData</title>
  <meta name="keywords" content="exportData">
  <meta name="description" content=" exports data from both GUIs into various formats">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # nucleus --><!-- # functions --><!-- menu.html interface -->
<h1>exportData
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> exports data from both GUIs into various formats</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function exportData(fig_tag,format) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">exportData exports data from both GUIs into various formats

 Syntax:
       exportData(fig_tag,format)

 Inputs:
       fig_tag - 'MOD' or 'INV'
       format - 'matS', 'matA', 'excelS' or 'LIAG'

 Outputs:
       none

 Example:
       exportData('INV','matS')

 Other m-files required:
       clearSingleAxis

 Subfunctions:
       checkINV
       checkMOD
       exportINV_EXCEL
       exportINV_CSV
       exportMOD_EXCEL
       findApproxTlgmAmplitude

 MAT-files required:
       none

 See also: NUCLEUSinv, NUCLEUSmod
 Author: Thomas Hiller
 email: thomas.hiller[at]leibniz-liag.de
 License: MIT License (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>	 clears all axes of a given figure</li><li><a href="exportGraphics.html" class="code" title="function varargout = exportGraphics(fig_tag,format)">exportGraphics</a>	 exports graphics from both GUIs into various formats</li><li><a href="exportINV.html" class="code" title="function exportINV(format,varargin)">exportINV</a>	 exports NUCLEUSinv GUI data to a mat-file</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/callbacks/contextmenus/onContextSignalList.html" class="code" title="function onContextSignalList(src,~)">onContextSignalList</a>	 handles the calls from the context menu of the data</li><li><a href="../../../nucleus/callbacks/menus/onMenuExportData.html" class="code" title="function onMenuExportData(src,~)">onMenuExportData</a>	 handles the calls from the export menu</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function exportINV_EXCEL(gui,INVdata,id,sfile,spath)</a></li><li><a href="#_sub2" class="code">function exportINV_CSV(INVdata,sfile)</a></li><li><a href="#_sub3" class="code">function exportMOD_EXCEL()</a></li><li><a href="#_sub4" class="code">function doexport = checkINV(INVdata,id)</a></li><li><a href="#_sub5" class="code">function doexport = checkMOD(data)</a></li><li><a href="#_sub6" class="code">function amp = findApproxTlgmAmplitude(t,f,TLGM)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function exportData(fig_tag,format)</a>
0002 <span class="comment">%exportData exports data from both GUIs into various formats</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       exportData(fig_tag,format)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       fig_tag - 'MOD' or 'INV'</span>
0009 <span class="comment">%       format - 'matS', 'matA', 'excelS' or 'LIAG'</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Outputs:</span>
0012 <span class="comment">%       none</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Example:</span>
0015 <span class="comment">%       exportData('INV','matS')</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Other m-files required:</span>
0018 <span class="comment">%       clearSingleAxis</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Subfunctions:</span>
0021 <span class="comment">%       checkINV</span>
0022 <span class="comment">%       checkMOD</span>
0023 <span class="comment">%       exportINV_EXCEL</span>
0024 <span class="comment">%       exportINV_CSV</span>
0025 <span class="comment">%       exportMOD_EXCEL</span>
0026 <span class="comment">%       findApproxTlgmAmplitude</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% MAT-files required:</span>
0029 <span class="comment">%       none</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% See also: NUCLEUSinv, NUCLEUSmod</span>
0032 <span class="comment">% Author: Thomas Hiller</span>
0033 <span class="comment">% email: thomas.hiller[at]leibniz-liag.de</span>
0034 <span class="comment">% License: MIT License (at end)</span>
0035 
0036 <span class="comment">%------------- BEGIN CODE --------------</span>
0037 
0038 <span class="comment">%% get GUI handle and data</span>
0039 fig = findobj(<span class="string">'Tag'</span>,fig_tag);
0040 gui = getappdata(fig,<span class="string">'gui'</span>);
0041 data = getappdata(fig,<span class="string">'data'</span>);
0042 
0043 <span class="keyword">switch</span> fig_tag
0044     <span class="keyword">case</span> <span class="string">'INV'</span>
0045         <span class="comment">% get inversion data</span>
0046         INVdata = getappdata(fig,<span class="string">'INVdata'</span>);
0047         
0048         <span class="comment">% which NMR signal</span>
0049         id = get(gui.listbox_handles.signal,<span class="string">'Value'</span>);
0050         
0051         <span class="comment">% check if data can be exported</span>
0052         doexport = <a href="#_sub4" class="code" title="subfunction doexport = checkINV(INVdata,id)">checkINV</a>(INVdata,id);
0053         
0054         <span class="keyword">if</span> doexport
0055             <span class="comment">% get the new file name</span>
0056             sfilename = data.import.NMR.filesShort{id};
0057             ind1 = strfind(sfilename,<span class="string">'.'</span>);
0058             <span class="keyword">if</span> isempty(ind1)
0059                 sfilename = [sfilename,<span class="string">'_INV'</span>];
0060             <span class="keyword">else</span>
0061                 sfilename = [sfilename(1:ind1-1),<span class="string">'_INV'</span>];
0062             <span class="keyword">end</span>
0063             
0064             <span class="comment">% different export formats</span>
0065             <span class="keyword">switch</span> format
0066                 <span class="keyword">case</span> <span class="string">'excelS'</span>
0067                     <span class="comment">% get the file name</span>
0068                     [sfile,spath] = uiputfile(<span class="string">'*.xlsx'</span>,<span class="keyword">...</span>
0069                         <span class="string">'Save inversion to Excel-file'</span>,<span class="keyword">...</span>
0070                         fullfile(data.import.path,[sfilename,<span class="string">'.xlsx'</span>]));
0071                     
0072                     <span class="comment">% if user didn't cancel</span>
0073                     <span class="keyword">if</span> sum([sfile spath]) &gt; 0
0074                         <a href="#_sub1" class="code" title="subfunction exportINV_EXCEL(gui,INVdata,id,sfile,spath)">exportINV_EXCEL</a>(gui,INVdata,id,sfile,spath);
0075                     <span class="keyword">end</span>
0076                     
0077                 <span class="keyword">case</span> <span class="string">'matS'</span>
0078                     <span class="comment">% get the file name</span>
0079                     [sfile,spath] = uiputfile(<span class="string">'*.mat'</span>,<span class="keyword">...</span>
0080                         <span class="string">'Save inversion to mat-file'</span>,<span class="keyword">...</span>
0081                         fullfile(data.import.path,[sfilename,<span class="string">'.mat'</span>]));
0082                     
0083                     <span class="comment">% if user didn't cancel</span>
0084                     <span class="keyword">if</span> sum([sfile spath]) &gt; 0
0085                         <span class="comment">% display info text</span>
0086                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0087                             <span class="string">'Exporting inversion data to mat-file ...'</span>);
0088                         <span class="comment">% gather all data</span>
0089                         idata.NMRdata = data.import.NMR.data{id};
0090                         idata.results = INVdata{id}.results;
0091                         idata.NUCLEUSinv_GUI = INVdata{id};
0092                         idata.NUCLEUSinv_GUI = rmfield(idata.NUCLEUSinv_GUI,<span class="string">'results'</span>);
0093                         
0094                         <span class="comment">% save to file</span>
0095                         save(fullfile(spath,sfile),<span class="string">'idata'</span>);
0096                         
0097                         <span class="comment">% display info text</span>
0098                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0099                             <span class="string">'Exporting inversion data to mat-file ... done'</span>);
0100                     <span class="keyword">else</span>
0101                         <span class="comment">% display info text</span>
0102                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0103                             <span class="string">'Exporting inversion data to mat-file ... canceled'</span>);
0104                     <span class="keyword">end</span>
0105                     
0106                 <span class="keyword">case</span> <span class="string">'matA'</span>
0107                     <span class="comment">% get the file name</span>
0108                     [sfile,spath] = uiputfile(<span class="string">'*.mat'</span>,<span class="keyword">...</span>
0109                         <span class="string">'Save inversion to mat-file'</span>,<span class="keyword">...</span>
0110                         fullfile(data.import.path,<span class="string">'inversion_set.mat'</span>));
0111                     <span class="comment">% if user didn't cancel</span>
0112                     <span class="keyword">if</span> sum([sfile spath]) &gt; 0
0113                         <span class="comment">% display info text</span>
0114                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0115                             <span class="string">'Exporting inversion set to mat-file ...'</span>);
0116                         idata = struct;
0117                         <span class="keyword">for</span> id = 1:size(INVdata,1)
0118                             <span class="keyword">if</span> isstruct(INVdata{id})
0119                                 results = INVdata{id}.results;
0120                                 results = rmfield(results,<span class="string">'nmrraw'</span>);
0121                                 results.nmraw = data.import.NMR.data{id};
0122                                 idata.results(id) = results;                                
0123                             <span class="keyword">end</span>
0124                         <span class="keyword">end</span>
0125                         idata.NUCLEUSinv_GUI = INVdata{1};
0126                         idata.NUCLEUSinv_GUI = rmfield(idata.NUCLEUSinv_GUI,<span class="string">'results'</span>);
0127                         
0128                         <span class="comment">% save to file</span>
0129                         save(fullfile(spath,sfile),<span class="string">'idata'</span>);
0130                         
0131                         <span class="comment">% display info text</span>
0132                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0133                             <span class="string">'Exporting inversion set to mat-file ... done'</span>);
0134                     <span class="keyword">else</span>
0135                         <span class="comment">% display info text</span>
0136                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0137                             <span class="string">'Exporting inversion set to mat-file ... canceled'</span>);
0138                     <span class="keyword">end</span>                    
0139                     
0140                 <span class="keyword">case</span> <span class="string">'LIAG'</span>
0141                     
0142                     <span class="keyword">if</span> isfield(data.import,<span class="string">'LIAG'</span>)
0143                         <span class="comment">% display info text</span>
0144                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0145                             <span class="string">'Exporting LIAG archive data ...'</span>);
0146                         <span class="comment">% find id of sample</span>
0147                         id = 1;
0148                         spath = data.import.LIAG.workpaths{id};
0149                         sfilename = [<span class="string">'INV_'</span>,data.import.NMR.filesShort{id}];
0150                         
0151                         <span class="comment">% session output</span>
0152                         silent.sname = fullfile(spath,[sfilename,<span class="string">'_session.mat'</span>]);
0153                         <a href="exportINV.html" class="code" title="function exportINV(format,varargin)">exportINV</a>(<span class="string">'session'</span>,silent);
0154                         
0155                         <span class="comment">% csv output</span>
0156                         csvname = fullfile(spath,[sfilename,<span class="string">'.csv'</span>]);
0157                         <a href="#_sub2" class="code" title="subfunction exportINV_CSV(INVdata,sfile)">exportINV_CSV</a>(INVdata{id},csvname);
0158                         
0159                         <span class="comment">% png graphics</span>
0160                         pngname = fullfile(spath,[sfilename,<span class="string">'.png'</span>]);
0161                         [f,ax] = <a href="exportGraphics.html" class="code" title="function varargout = exportGraphics(fig_tag,format)">exportGraphics</a>(<span class="string">'INV'</span>,<span class="string">'fig'</span>);
0162                         
0163                         figure(f);
0164                         por = INVdata{id}.invstd.porosity;
0165                         tname = [sfilename(5:end),<span class="string">' (water content: '</span>,<span class="keyword">...</span>
0166                             sprintf(<span class="string">'%2.1f'</span>,por*100),<span class="string">' vol. %)'</span>];
0167                         set(get(ax(1),<span class="string">'Title'</span>),<span class="string">'String'</span>,tname,<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0168                         
0169                         yy = get(ax(2),<span class="string">'YLim'</span>);
0170                         TLGM = INVdata{id}.results.invstd.Tlgm;
0171                         T = INVdata{id}.results.invstd.T1T2me;
0172                         F = INVdata{id}.results.invstd.T1T2f;
0173                         F = 100.*por.*F./sum(F);
0174                         amp = <a href="#_sub6" class="code" title="subfunction amp = findApproxTlgmAmplitude(t,f,TLGM)">findApproxTlgmAmplitude</a>(T,F,TLGM);
0175                         stem(TLGM,amp,<span class="keyword">...</span>
0176                             <span class="string">'x-'</span>,<span class="string">'Color'</span>,[0.3 0.3 0.3],<span class="string">'LineWidth'</span>,2,<span class="keyword">...</span>
0177                             <span class="string">'Tag'</span>,<span class="string">'TLGM'</span>,<span class="string">'Parent'</span>,ax(2));
0178                         
0179                         <span class="keyword">switch</span> INVdata{id}.process.timescale
0180                             <span class="keyword">case</span> <span class="string">'s'</span>
0181                                 CBW = INVdata{id}.param.CBWcutoff/1000;
0182                                 BVI = INVdata{id}.param.BVIcutoff/1000;
0183                             <span class="keyword">case</span> <span class="string">'ms'</span>
0184                                 CBW = INVdata{id}.param.CBWcutoff;
0185                                 BVI = INVdata{id}.param.BVIcutoff;
0186                         <span class="keyword">end</span>
0187                         line([CBW CBW],[yy(1) yy(2)],<span class="string">'Color'</span>,[0.3 0.3 0.3],<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="keyword">...</span>
0188                             <span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,ax(2),<span class="string">'Tag'</span>,<span class="string">'infolines'</span>);
0189                         line([BVI BVI],[yy(1) yy(2)],<span class="string">'Color'</span>,[0.3 0.3 0.3],<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="keyword">...</span>
0190                             <span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,ax(2),<span class="string">'Tag'</span>,<span class="string">'infolines'</span>);
0191                         legend(ax(2),<span class="string">'RTD'</span>,<span class="string">'TLGM'</span>,<span class="string">'cutoffs'</span>);
0192                         
0193                         CBWa = abs(sum(F(T&lt;=CBW))/sum(F));
0194                         BVIa = abs(sum(F(T&gt;CBW &amp; T&lt;=BVI))/sum(F));
0195                         BVMa = abs(sum(F(T&gt;BVI))/sum(F));
0196 <span class="comment">%                         tname2 = ['CBW: ',sprintf('%2.1f',por*100*CBWa),...</span>
0197 <span class="comment">%                             ' | BVI: ',sprintf('%2.1f',por*100*BVIa),...</span>
0198 <span class="comment">%                             ' | BVM: ',sprintf('%2.1f',por*100*BVMa),...</span>
0199 <span class="comment">%                             ' vol. % | TLGM: ',sprintf('%4.3f',TLGM),' [s]'];</span>
0200                         tname2 = [<span class="string">'CBW / BVI / BVM: '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*CBWa),<span class="keyword">...</span>
0201                             <span class="string">' / '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*BVIa),<span class="keyword">...</span>
0202                             <span class="string">' / '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*BVMa),<span class="keyword">...</span>
0203                             <span class="string">' vol. % | TLGM: '</span>,sprintf(<span class="string">'%4.3f'</span>,TLGM),<span class="string">' [s]'</span>];
0204                         set(get(ax(2),<span class="string">'Title'</span>),<span class="string">'String'</span>,tname2,<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0205                         
0206                         set(f,<span class="string">'PaperType'</span>,<span class="string">'A4'</span>,<span class="string">'PaperUnits'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
0207                             <span class="string">'PaperOrientation'</span>,<span class="string">'portrait'</span>);
0208                         set(f,<span class="string">'PaperPositionMode'</span>,<span class="string">'manual'</span>,<span class="keyword">...</span>
0209                             <span class="string">'PaperPosition'</span>,[0.6 6.2 19.7 17.2]);
0210                         set(f,<span class="string">'Renderer'</span>,<span class="string">'painter'</span>);
0211                         print(f,pngname,<span class="string">'-r300'</span>,<span class="string">'-dpng'</span>);
0212                         close(f);
0213                         
0214                         <span class="comment">% display info text</span>
0215                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0216                             <span class="string">'Exporting LIAG archive data ... done'</span>);
0217                         
0218                     <span class="keyword">else</span>
0219                         helpdlg({<span class="string">'function: exportData'</span>,<span class="keyword">...</span>
0220                             <span class="string">'This routine works only on LIAG specific project data.'</span>},<span class="keyword">...</span>
0221                             <span class="string">'No LIAG data'</span>);
0222                     <span class="keyword">end</span>
0223             <span class="keyword">end</span>
0224         <span class="keyword">end</span>
0225         
0226     <span class="keyword">case</span> <span class="string">'MOD'</span>
0227         <span class="comment">% check if data can be exported</span>
0228         doexport = <a href="#_sub5" class="code" title="subfunction doexport = checkMOD(data)">checkMOD</a>(data);
0229         <span class="keyword">if</span> doexport
0230             <span class="comment">% different export formats</span>
0231             <span class="keyword">switch</span> format
0232                 <span class="keyword">case</span> <span class="string">'mat'</span>                    
0233                     <span class="comment">% gather all relevant data</span>
0234                     out = data.results;
0235                     <span class="keyword">if</span> isfield(out.NMR.raw,<span class="string">'Tb'</span>)
0236                         out.NMR.raw = rmfield(out.NMR.raw,<span class="string">'Tb'</span>);
0237                     <span class="keyword">end</span>
0238                     <span class="keyword">if</span> isfield(out.NMR.raw,<span class="string">'rho'</span>)
0239                         out.NMR.raw = rmfield(out.NMR.raw,<span class="string">'rho'</span>);
0240                     <span class="keyword">end</span>
0241                     out.NMRMOD_GUI.geometry = data.geometry;
0242                     out.NMRMOD_GUI.pressure = data.pressure;
0243                     out.NMRMOD_GUI.nmr = data.nmr;
0244                     out.NMRMOD_GUI.myui = gui.myui;
0245                     
0246                     <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to MAT-file ...'</span>);
0247                     [FileName,PathName,~] = uiputfile({<span class="string">'*.mat'</span>,<span class="string">'Matlab file'</span>},<span class="string">'NUCLEUSmod: Save Data'</span>,fullfile(pwd,<span class="string">'NUCLEUSmod_forward.mat'</span>));
0248                     
0249                     <span class="keyword">if</span> ~isequal(FileName,0) || ~isequal(PathName,0)
0250                         clear data
0251                         data = out; <span class="comment">%#ok&lt;NASGU&gt;</span>
0252                         save(fullfile(PathName,FileName),<span class="string">'data'</span>);
0253                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to MAT-file ... done.'</span>);
0254                     <span class="keyword">else</span>
0255                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to MAT-file ... canceled.'</span>);
0256                     <span class="keyword">end</span>
0257                     
0258                 <span class="keyword">case</span> <span class="string">'xls'</span>                    
0259                     indd = data.pressure.DrainLevels;
0260                     indi = data.pressure.ImbLevels;
0261                     results = data.results;
0262                     
0263                     <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to XLS-file ...'</span>);
0264                     [FileName,PathName,~] = uiputfile({<span class="string">'*.xls'</span>,<span class="string">'XLS file'</span>},<span class="string">'NUCLEUSmod: Save Data'</span>,fullfile(pwd,<span class="string">'NUCLEUSmod_forward.xls'</span>));
0265                     
0266                     <span class="keyword">if</span> ~isequal(FileName,0) || ~isequal(PathName,0)
0267                         <a href="#_sub3" class="code" title="subfunction exportMOD_EXCEL()">exportMOD_EXCEL</a>;
0268                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to XLS-file ... done.'</span>);
0269                     <span class="keyword">else</span>
0270                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to XLS-file ... canceled.'</span>);
0271                     <span class="keyword">end</span>
0272                     
0273                 <span class="keyword">otherwise</span>
0274                     helpdlg({<span class="string">'exportData:'</span>,<span class="string">'Not yet implemented.'</span>},<span class="string">'NUCLEUSmod info:'</span>);
0275                     
0276             <span class="keyword">end</span>
0277         <span class="keyword">end</span>
0278 <span class="keyword">end</span>
0279 
0280 <span class="keyword">end</span>
0281 
0282 <span class="comment">%%</span>
0283 <a name="_sub1" href="#_subfunctions" class="code">function exportINV_EXCEL(gui,INVdata,id,sfile,spath)</a>
0284 unit = INVdata{id}.process.timescale;
0285 
0286 <span class="comment">% gather all data</span>
0287 <span class="comment">% raw data</span>
0288 tmp1(:,1) = INVdata{id}.results.nmrraw.t(:);
0289 header1{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0290 <span class="keyword">if</span> isreal(INVdata{id}.results.nmrraw.s(:))
0291     header1{2} = <span class="string">'amplitude [a.u.]'</span>;
0292     tmp1(:,2) = INVdata{id}.results.nmrraw.s(:);
0293     
0294     b1 = {<span class="string">'raw data'</span>,<span class="string">''</span>};
0295     b1(2,:) = header1;
0296     b1(3:2+size(tmp1,1),:) = [num2cell(tmp1(:,1)),num2cell(tmp1(:,2))];
0297 <span class="keyword">else</span>
0298     header1{2} = <span class="string">'real [a.u.]'</span>;
0299     header1{3} = <span class="string">'imag [a.u.]'</span>;
0300     tmp1(:,2) = real(INVdata{id}.results.nmrraw.s(:));
0301     tmp1(:,3) = imag(INVdata{id}.results.nmrraw.s(:));
0302     
0303     b1 = {<span class="string">'raw data'</span>,<span class="string">''</span>,<span class="string">''</span>};
0304     b1(2,:) = header1;
0305     b1(3:2+size(tmp1,1),:) = [num2cell(tmp1(:,1)),num2cell(tmp1(:,2)),<span class="keyword">...</span>
0306         num2cell(tmp1(:,3))];
0307 <span class="keyword">end</span>
0308 
0309 <span class="comment">% proc data</span>
0310 tmp2(:,1) = INVdata{id}.results.nmrproc.t(:);
0311 tmp2(:,2) = INVdata{id}.results.nmrproc.s(:);
0312 header2{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0313 header2{2} = <span class="string">'amplitude [a.u.]'</span>;
0314 
0315 b2 = {<span class="string">'proc data'</span>,<span class="string">''</span>};
0316 b2(2,:) = header2;
0317 b2(3:2+size(tmp2,1),:) = [num2cell(tmp2(:,1)),num2cell(tmp2(:,2))];
0318 
0319 <span class="comment">% fit data (incl. residuals)</span>
0320 tmp3(:,1) = INVdata{id}.results.invstd.fit_t(:);
0321 tmp3(:,2) = INVdata{id}.results.invstd.fit_s(:);
0322 tmp3(:,3) = INVdata{id}.results.invstd.residual(:);
0323 header3{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0324 header3{2} = <span class="string">'amplitude [a.u.]'</span>;
0325 header3{3} = <span class="string">'residual [-]'</span>;
0326 
0327 b3 = {<span class="string">'fit data'</span>,<span class="string">''</span>,<span class="string">''</span>};
0328 b3(2,:) = header3;
0329 b3(3:2+size(tmp3,1),:) = [num2cell(tmp3(:,1)),num2cell(tmp3(:,2)),<span class="keyword">...</span>
0330     num2cell(tmp3(:,3))];
0331 
0332 <span class="comment">% relaxation times</span>
0333 <span class="keyword">switch</span> INVdata{id}.invstd.invtype
0334     <span class="keyword">case</span> {<span class="string">'mono'</span>,<span class="string">'free'</span>}
0335         <span class="keyword">switch</span> INVdata{id}.results.nmrproc.T1T2
0336             <span class="keyword">case</span> <span class="string">'T1'</span>
0337                 tmp4 = [INVdata{id}.results.invstd.T1(:)<span class="keyword">...</span>
0338                     INVdata{id}.results.invstd.E0(:)];
0339                 header4 = {[<span class="string">'T1 ['</span>,unit,<span class="string">']'</span>],<span class="string">'amplitude [a.u.]'</span>};
0340             <span class="keyword">case</span> <span class="string">'T2'</span>
0341                 tmp4 = [INVdata{id}.results.invstd.T2(:)<span class="keyword">...</span>
0342                     INVdata{id}.results.invstd.E0(:)];
0343                 header4 = {[<span class="string">'T2 ['</span>,unit,<span class="string">']'</span>],<span class="string">'amplitude [a.u.]'</span>};
0344         <span class="keyword">end</span>
0345         
0346     <span class="keyword">case</span> {<span class="string">'ILA'</span>,<span class="string">'NNLS'</span>}
0347         tmp4 = [INVdata{id}.results.invstd.T1T2me(:)<span class="keyword">...</span>
0348             INVdata{id}.results.invstd.T1T2f(:)];
0349         header4 = {[<span class="string">'relaxation times ['</span>,unit,<span class="string">']'</span>],<span class="string">'amplitudes [a.u.]'</span>};
0350         
0351     <span class="keyword">otherwise</span>
0352         disp(<span class="string">'Something is utterly wrong.'</span>)
0353 <span class="keyword">end</span>
0354 
0355 b4 = {<span class="string">'relaxation times'</span>,<span class="string">''</span>};
0356 b4(2,:) = header4;
0357 b4(3:2+size(tmp4,1),:) = [num2cell(tmp4(:,1)),num2cell(tmp4(:,2))];
0358 
0359 <span class="comment">% glue together the output matrix</span>
0360 out(1:size(b1,1),1:size(b1,2)) = b1;
0361 yi = size(b1,2)+2;
0362 out(1:size(b2,1),yi:yi-1+size(b2,2)) = b2;
0363 yi = yi + size(b2,2)+1;
0364 out(1:size(b3,1),yi:yi-1+size(b3,2)) = b3;
0365 yi = yi + size(b3,2)+1;
0366 out(1:size(b4,1),yi:yi-1+size(b4,2)) = b4;
0367 
0368 <span class="comment">% display info text</span>
0369 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0370     <span class="string">'Exporting inversion data to Excel-file ...'</span>);
0371 <span class="comment">% save to file</span>
0372 xlswrite(fullfile(spath,sfile),out,<span class="string">'NMRdata'</span>,<span class="string">'A1'</span>);
0373 
0374 <span class="comment">% remove the first standard excel sheet</span>
0375 [~,sheets] = xlsfinfo(fullfile(spath,sfile));
0376 objExcel = actxserver(<span class="string">'Excel.Application'</span>);
0377 objExcel.Workbooks.Open(fullfile(spath,sfile));
0378 objExcel.ActiveWorkbook.Worksheets.Item(sheets{1}).Delete;
0379 objExcel.ActiveWorkbook.Save;
0380 objExcel.ActiveWorkbook.Close;
0381 objExcel.Quit;
0382 objExcel.delete;
0383 <span class="comment">% display info text</span>
0384 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0385     <span class="string">'Exporting inversion data to Excel-file ... done'</span>);
0386 <span class="keyword">end</span>
0387 
0388 <span class="comment">%%</span>
0389 <a name="_sub2" href="#_subfunctions" class="code">function exportINV_CSV(INVdata,sfile)</a>
0390 unit = INVdata.process.timescale;
0391 
0392 <span class="comment">% gather all data</span>
0393 <span class="comment">% proc data</span>
0394 tmp2(:,1) = INVdata.results.nmrproc.t(:);
0395 tmp2(:,2) = INVdata.results.nmrproc.s(:);
0396 header2{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0397 header2{2} = <span class="string">'signal [a.u.]'</span>;
0398 
0399 <span class="comment">% fit data (incl. residuals)</span>
0400 tmp3(:,1) = INVdata.results.invstd.fit_t(:);
0401 tmp3(:,2) = INVdata.results.invstd.fit_s(:);
0402 tmp3(:,3) = INVdata.results.invstd.residual(:);
0403 header3{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0404 header3{2} = <span class="string">'fit [a.u.]'</span>;
0405 header3{3} = <span class="string">'residual [-]'</span>;
0406 
0407 <span class="comment">% relaxation times</span>
0408 <span class="keyword">switch</span> INVdata.invstd.invtype
0409     <span class="keyword">case</span> {<span class="string">'ILA'</span>,<span class="string">'NNLS'</span>}
0410         por = INVdata.invstd.porosity;
0411         F = INVdata.results.invstd.T1T2f(:);
0412         F = 100*por.*F./sum(F);
0413         tmp4 = [INVdata.results.invstd.T1T2me(:)<span class="keyword">...</span>
0414             INVdata.results.invstd.T1T2f(:) F];
0415         header4 = {[<span class="string">'relaxation times ['</span>,unit,<span class="string">']'</span>],<span class="string">'frequency [-]'</span>,<span class="string">' water content [vol. %]'</span>};
0416         
0417     <span class="keyword">otherwise</span>
0418         <span class="comment">% Nothing to do</span>
0419 <span class="keyword">end</span>
0420 
0421 <span class="comment">% glue together headers</span>
0422 cHeader = [header2 header3 header4];
0423 <span class="comment">% insert commas</span>
0424 commaHeader = [cHeader;repmat({<span class="string">','</span>},1,numel(cHeader))]; 
0425 commaHeader = commaHeader(:)';
0426 <span class="comment">% cHeader as string with commas</span>
0427 textHeader = cell2mat(commaHeader(1:numel(commaHeader)-1)); 
0428 
0429 maxrows = max([size(tmp2,1) size(tmp3,1) size(tmp4,1)]);
0430 <span class="comment">% glue together data</span>
0431 <span class="keyword">if</span> size(tmp2,1) &lt; maxrows
0432     tmp2(end+1:maxrows,:) = NaN;
0433 <span class="keyword">end</span>
0434 <span class="keyword">if</span> size(tmp3,1) &lt; maxrows
0435     tmp3(end+1:maxrows,:) = NaN;
0436 <span class="keyword">end</span>
0437 <span class="keyword">if</span> size(tmp4,1) &lt; maxrows
0438     tmp4(end+1:maxrows,:) = NaN;
0439 <span class="keyword">end</span>
0440 out(1:maxrows,1:size(tmp2,2)) = tmp2;
0441 yi = size(tmp2,2)+1;
0442 out(1:maxrows,yi:yi-1+size(tmp3,2)) = tmp3;
0443 yi = yi + size(tmp3,2);
0444 out(1:maxrows,yi:yi-1+size(tmp4,2)) = tmp4;
0445 
0446 <span class="comment">% save to file</span>
0447 <span class="comment">%write header to file</span>
0448 fid = fopen(sfile,<span class="string">'w'</span>); 
0449 fprintf(fid,<span class="string">'%s\n'</span>,textHeader);
0450 fclose(fid);
0451 <span class="comment">%write data to end of file</span>
0452 dlmwrite(sfile,out,<span class="string">'-append'</span>,<span class="string">'precision'</span>,<span class="string">'%.5f'</span>);
0453 
0454 <span class="keyword">end</span>
0455 
0456 <span class="comment">%%</span>
0457 <a name="_sub3" href="#_subfunctions" class="code">function exportMOD_EXCEL()</a>
0458 xlswrite(fullfile(PathName,FileName),{<span class="string">'pressure [Pa]'</span>,<span class="string">'saturation (drain)'</span>,<span class="string">'saturation (imb)'</span>},<span class="string">'CPS'</span>,<span class="string">'A1'</span>);
0459 xlswrite(fullfile(PathName,FileName),[results.SAT.pressure(:) results.SAT.Sdfull(:) results.SAT.Sifull(:)],<span class="string">'CPS'</span>,<span class="string">'A2'</span>);
0460 
0461 out = zeros(numel(results.NMR.t),numel(indd)+1);
0462 out(:,1) = results.NMR.t(:);
0463 header = cell(1,1);
0464 header{1} = <span class="string">'time [s]'</span>;
0465 <span class="keyword">for</span> i = 1:numel(indd)
0466     out(:,i+1) = results.NMR.EdT1(indd(i),:)';
0467     header{i+1} = [<span class="string">'S'</span>,num2str(i)];
0468 <span class="keyword">end</span>
0469 xlswrite(fullfile(PathName,FileName),header,<span class="string">'NMR_T1_drain'</span>,<span class="string">'A1'</span>);
0470 xlswrite(fullfile(PathName,FileName),out,<span class="string">'NMR_T1_drain'</span>,<span class="string">'A2'</span>);
0471 out = zeros(numel(results.NMR.t),numel(indd)+1);
0472 out(:,1) = results.NMR.t(:);
0473 header = cell(1,1);
0474 header{1} = <span class="string">'time [s]'</span>;
0475 <span class="keyword">for</span> i = 1:numel(indd)
0476     out(:,i+1) = results.NMR.EdT2(indd(i),:)';
0477     header{i+1} = [<span class="string">'S'</span>,num2str(i)];
0478 <span class="keyword">end</span>
0479 xlswrite(fullfile(PathName,FileName),header,<span class="string">'NMR_T2_drain'</span>,<span class="string">'A1'</span>);
0480 xlswrite(fullfile(PathName,FileName),out,<span class="string">'NMR_T2_drain'</span>,<span class="string">'A2'</span>);
0481 
0482 out = zeros(numel(results.NMR.t),numel(indi)+1);
0483 out(:,1) = results.NMR.t(:);
0484 header = cell(1,1);
0485 header{1} = <span class="string">'time [s]'</span>;
0486 <span class="keyword">for</span> i = 1:numel(indi)
0487     out(:,i+1) = results.NMR.EiT1(indi(i),:)';
0488     header{i+1} = [<span class="string">'S'</span>,num2str(i)];
0489 <span class="keyword">end</span>
0490 xlswrite(fullfile(PathName,FileName),header,<span class="string">'NMR_T1_imb'</span>,<span class="string">'A1'</span>);
0491 xlswrite(fullfile(PathName,FileName),out,<span class="string">'NMR_T1_imb'</span>,<span class="string">'A2'</span>);
0492 
0493 out = zeros(numel(results.NMR.t),numel(indi)+1);
0494 out(:,1) = results.NMR.t(:);
0495 header = cell(1,1);
0496 header{1} = <span class="string">'time [s]'</span>;
0497 <span class="keyword">for</span> i = 1:numel(indi)
0498     out(:,i+1) = results.NMR.EiT2(indi(i),:)';
0499     header{i+1} = [<span class="string">'S'</span>,num2str(i)];
0500 <span class="keyword">end</span>
0501 xlswrite(fullfile(PathName,FileName),header,<span class="string">'NMR_T2_imb'</span>,<span class="string">'A1'</span>);
0502 xlswrite(fullfile(PathName,FileName),out,<span class="string">'NMR_T2_imb'</span>,<span class="string">'A2'</span>);
0503 
0504 <span class="comment">% remove the first standard excel sheet</span>
0505 [~,sheets] = xlsfinfo(fullfile(PathName,FileName));
0506 objExcel = actxserver(<span class="string">'Excel.Application'</span>);
0507 objExcel.Workbooks.Open(fullfile(PathName,FileName));
0508 objExcel.ActiveWorkbook.Worksheets.Item(sheets{1}).Delete;
0509 objExcel.ActiveWorkbook.Save;
0510 objExcel.ActiveWorkbook.Close;
0511 objExcel.Quit;
0512 objExcel.delete;
0513 <span class="keyword">end</span>
0514 
0515 <span class="comment">%%</span>
0516 <a name="_sub4" href="#_subfunctions" class="code">function doexport = checkINV(INVdata,id)</a>
0517 
0518 doexport = false;
0519 <span class="keyword">if</span> ~isempty(INVdata) &amp;&amp; ~isempty(id)
0520     <span class="keyword">if</span> isstruct(INVdata{id})
0521         doexport = true;
0522     <span class="keyword">else</span>
0523         helpdlg({<span class="string">'exportData:'</span>,<span class="string">'No inversion data to save'</span>},<span class="keyword">...</span>
0524             <span class="string">'Nothing to save'</span>);
0525     <span class="keyword">end</span>
0526 <span class="keyword">else</span>
0527     helpdlg({<span class="string">'exportData:'</span>,<span class="string">'No inversion data to save'</span>},<span class="keyword">...</span>
0528         <span class="string">'Nothing to save'</span>);
0529 <span class="keyword">end</span>
0530 
0531 <span class="keyword">end</span>
0532 
0533 <span class="comment">%%</span>
0534 <a name="_sub5" href="#_subfunctions" class="code">function doexport = checkMOD(data)</a>
0535 
0536 doexport = false;
0537 <span class="keyword">if</span> isfield(data,<span class="string">'results'</span>)
0538     <span class="keyword">if</span> isfield(data.results,<span class="string">'NMR'</span>)
0539         doexport = true;
0540     <span class="keyword">else</span>
0541         helpdlg({<span class="string">'exportData:'</span>,<span class="keyword">...</span>
0542             <span class="string">'No data to save. Generate some data first.'</span>},<span class="string">'NUCLEUSmod info:'</span>);
0543     <span class="keyword">end</span>
0544 <span class="keyword">else</span>
0545     helpdlg({<span class="string">'exportData:'</span>,<span class="keyword">...</span>
0546         <span class="string">'No data to save. Generate some data first.'</span>},<span class="string">'NUCLEUSmod info:'</span>);
0547 <span class="keyword">end</span>
0548 
0549 <span class="keyword">end</span>
0550 
0551 <span class="comment">%%</span>
0552 <a name="_sub6" href="#_subfunctions" class="code">function amp = findApproxTlgmAmplitude(t,f,TLGM)</a>
0553 index = find(abs(t-TLGM)==min(abs(t-TLGM)));
0554 amp = interp1(t(index-1:index+1),f(index-1:index+1),TLGM);
0555 <span class="keyword">end</span>
0556 
0557 <span class="comment">%------------- END OF CODE --------------</span>
0558 
0559 <span class="comment">%% License:</span>
0560 <span class="comment">% MIT License</span>
0561 <span class="comment">%</span>
0562 <span class="comment">% Copyright (c) 2018 Thomas Hiller</span>
0563 <span class="comment">%</span>
0564 <span class="comment">% Permission is hereby granted, free of charge, to any person obtaining a copy</span>
0565 <span class="comment">% of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
0566 <span class="comment">% in the Software without restriction, including without limitation the rights</span>
0567 <span class="comment">% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
0568 <span class="comment">% copies of the Software, and to permit persons to whom the Software is</span>
0569 <span class="comment">% furnished to do so, subject to the following conditions:</span>
0570 <span class="comment">%</span>
0571 <span class="comment">% The above copyright notice and this permission notice shall be included in all</span>
0572 <span class="comment">% copies or substantial portions of the Software.</span>
0573 <span class="comment">%</span>
0574 <span class="comment">% THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
0575 <span class="comment">% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
0576 <span class="comment">% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
0577 <span class="comment">% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
0578 <span class="comment">% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
0579 <span class="comment">% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
0580 <span class="comment">% SOFTWARE.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>